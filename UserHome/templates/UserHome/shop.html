{% extends 'UserHome/base.html' %}

{% block title %}Shop{% endblock %}

{% block content %}
		<!--start page wrapper -->
		<div class="page-wrapper">
			<div class="page-content">
				<!--start breadcrumb-->
				<section class="py-3 border-bottom border-top d-none d-md-flex bg-light">
					<div class="container">
						<div class="page-breadcrumb d-flex align-items-center">
							<h3 class="breadcrumb-title pe-3">Shop</h3>
							<div class="ms-auto">
								<nav aria-label="breadcrumb">
									<ol class="breadcrumb mb-0 p-0">
										<li class="breadcrumb-item"><a href="{% url 'UserHome' %}"><i class="bx bx-home-alt"></i> Home</a>
										</li>
										<li class="breadcrumb-item"><a href="#">Shop</a>
									</ol>
								</nav>
							</div>
						</div>
					</div>
				</section>
				<!--end breadcrumb-->
				<!--start shop area-->
				<section class="py-4">
					<div class="container">
						<div class="btn btn-dark btn-ecomm d-xl-none position-fixed top-50 start-0 translate-middle-y z-index-1"  data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbarFilter"><span><i class='bx bx-filter-alt me-1'></i>Filters</span></div>
						<div class="row">
							<div class="col-12 col-xl-3 filter-column">
								<nav class="navbar navbar-expand-xl flex-wrap p-0">
								  <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasNavbarFilter" aria-labelledby="offcanvasNavbarFilterLabel">
									<div class="offcanvas-header">
									  <h5 class="offcanvas-title mb-0 fw-bold" id="offcanvasNavbarFilterLabel">Filters</h5>
									  <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
									</div>
									<div class="offcanvas-body">
									  <div class="filter-sidebar">
										<div class="card rounded shadow-none border ">
										  <div class="card-header d-none d-xl-block bg-transparent">
											  <h5 class="mb-0 fw-bold">Filters</h5>
										  </div>
										  <div class="card-body">
											<h6 class="p-1 fw-bold bg-light">Categories</h6>
											  <div class="categories">
											   <div class="categories-wrapper height-1 p-1">
												{% for category in categories %}
												<div class="form-check">
												  <input class="form-check-input filter-checkbox" data-filter="category" type="checkbox" name="checkbox" value="{{ category.id }}" id="chekCate1">
												  <label class="form-check-label" for="chekCate1">
													<span>{{ category.name }}</span><span class="product-number">({{ category.active_products_count }})</span>
												  </label>
												</div>
												{% endfor %}
											   </div>
											</div>
											<hr>
											<div class="brands">
											  <h6 class="p-1 fw-bold bg-light">Brands</h6>
											   <div class="brands-wrapper height-1 p-1">
												{% for brand in brands %}
												<div class="form-check">
												  <input class="form-check-input filter-checkbox" data-filter="brand"  type="checkbox" name="checkbox" value="{{ brand.id }}" id="chekBrand1">
												  <label class="form-check-label" for="chekBrand1">
													<span>{{ brand.name }}</span><span class="product-number">
														({{ brand.active_products_count }})
													</span>
												  </label>
												</div>
												{% endfor %}
												
											   </div>
											</div>
											<hr>
											<div class="Price">
											  <h6 class="p-1 fw-bold bg-light">Price</h6>
											   <div class="Price-wrapper p-1">
												<div class="input-group">
												  <input type="text" id="minPrice" class="form-control rounded" placeholder="₹10">
												  <span class="input-group-text bg-section-1 border-0 rounded mx-1">-</span>
												  <input type="text" id="maxPrice" class="form-control rounded" placeholder="₹10000">
												  <button type="button" class="filter-checkbox btn btn-outline-dark rounded ms-2"><i class='bx bx-chevron-right me-0'></i></button>
												</div>
											   </div>
											 </div>
											 <hr>
											 <div class="colors">
											  <h6 class="p-1 fw-bold bg-light">Size</h6>
											   <div class="color-wrapper height-1 p-1">
												{% for size, count in variant_dict.items %}
													<div class="form-check">
														<input class="form-check-input filter-checkbox" data-filter="size" name="checkbox" value="{{ size }}" type="checkbox" value="" id="chekColor1">
														<label class="form-check-label" for="chekColor1">
															<span>{{ size }}</span>
															<span class="product-number">({{ count }})</span>
														</label>
													</div>
												{% endfor %}

												 
											   </div>
											 </div>
											 <hr>
											 <div class="discount">
											  <h6 class="p-1 fw-bold bg-light">Discount Range</h6>
											   <div class="discount-wrapper p-1">
												<div class="form-check">
												  <input class="form-check-input filter-checkbox" data-filter="discount" name="checkbox" value="10" type="checkbox" id="chekDisc1">
												  <label class="form-check-label" for="chekDisc1">
													10% and Above
												  </label>
												</div>
												<div class="form-check">
												  <input class="form-check-input filter-checkbox" data-filter="discount" name="checkbox" value="20" type="checkbox" id="chekDisc1">
												  <label class="form-check-label" for="chekDisc2">
													20% and Above
												  </label>
												</div>
												<div class="form-check">
												  <input class="form-check-input filter-checkbox" data-filter="discount" name="checkbox" value="30" type="checkbox" id="chekDisc1">
												  <label class="form-check-label" for="chekDisc3">
													30% and Above
												  </label>
												</div>
												<div class="form-check">
												  <input class="form-check-input filter-checkbox" data-filter="discount" name="checkbox" value="40" type="checkbox" id="chekDisc1">
												  <label class="form-check-label" for="chekDisc4">
													40% and Above
												  </label>
												</div>
												<div class="form-check">
												  <input class="form-check-input filter-checkbox" data-filter="discount" name="checkbox" value="50" type="checkbox" id="chekDisc1">
												  <label class="form-check-label" for="chekDisc5">
													50% and Above
												  </label>
												</div>
												<div class="form-check">
												  <input class="form-check-input filter-checkbox" data-filter="discount" name="checkbox" value="60" type="checkbox" id="chekDisc1">
												  <label class="form-check-label" for="chekDisc6">
													60% and Above
												  </label>
												</div>
												<div class="form-check">
												  <input class="form-check-input filter-checkbox" data-filter="discount" name="checkbox" value="70" type="checkbox" id="chekDisc1">
												  <label class="form-check-label" for="chekDisc7">
													70% and Above
												  </label>
												</div>
												<div class="form-check">
												  <input class="form-check-input filter-checkbox" data-filter="discount" name="checkbox" value="80" type="checkbox" id="chekDisc1">
												  <label class="form-check-label" for="chekDisc8">
													80% and Above
												  </label>
												</div>
												</div>
											  </div>
										  </div>
										</div>
									  </div>
									</div>
								  </div>
							  </nav>
							</div>
							<div class="col-12 col-xl-9">
								<div class="product-wrapper">
									<div class="toolbox d-flex align-items-center mb-3 gap-2 border rounded p-3">
										<div class="d-flex flex-wrap flex-grow-1 gap-1">
											<div class="d-flex align-items-center flex-nowrap">
												<p class="mb-0 font-13 text-nowrap">Sort By:</p>
												<form action="{% url 'shop' %}" method="post">
													{% csrf_token%}
												<select name="sortOption" class="form-select ms-3 rounded">
													<option value="">Default sorting (New to Old)</option>
													<option value="id">Sort by Old to New</option>
													<option value="display_price">Sort by price: low to high</option>
													<option value="-display_price">Sort by price: high to low</option>
												</select>
											</div>
											<button type="submit" class="btn btn-dark rounded mx-4 fw-bold">Sort</button>
										</form>
										</div>
									</div>
									<div class="product-grid">
										<div class="row row-cols-2 row-cols-md-3 row-cols-lg-3 row-cols-xl-3 row-cols-xxl-3 g-3 g-sm-4" id="filtered-product" style="height:10%">
											{% for product in paginated_objects %}
											<div class="col">
												<div class="card">
													<div class="position-relative overflow-hidden rounded">
														<div class="image-wrapper rounded" style="overflow: hidden;">
															<a href="{% url 'product_details' product.id %}" class="rounded">
																<img src="{{ product.thumbnail.url }}" class="img-fluid rounded" style="width: 100%; height: 30vh; object-fit: contain; background-color: white;" alt="{{ product.thumbnail.url }}">
															</a>
														</div>
													</div>
													<div class="card-body px-0">
														<div class="d-flex align-items-center justify-content-between">
															<div>
																<p class="mb-1 product-short-name">{{ product.brand|upper }}</p>
																<h6 class="mb-0 fw-bold product-short-title">{{ product.name }}</h6>
															</div>
															{% if request.user.is_authenticated %}
																{% if product.is_added_to_wishlist %}
																	<i class="bi bi-heart-fill text-danger fs-4"></i>
																{% else %}
																	<a href="{% url 'user_product:add_to_wishlist' product.id %}" class="add-to-wishlist-link"><i class="bi bi-heart text-secondary fs-4"></i></a>
																{% endif %}
															{% endif %}
														</div>
														<div class="cursor-pointer rating mt-2">
															<i class="bx bxs-star text-warning"></i>
															<i class="bx bxs-star text-warning"></i>
															<i class="bx bxs-star text-warning"></i>
															<i class="bx bxs-star text-warning"></i>
															<i class="bx bxs-star text-warning"></i>
														</div>
														<div class="product-price d-flex align-items-center justify-content-start gap-2 mt-2">
															{% if product.offer %}
															<div class="h6 fw-bold" style="font-size: 17px;">₹{{ product.display_price }}</div>
															<div class="h6 fw-light fw-bold text-secondary text-decoration-line-through" style="font-size: 15px;">{{ product.formatted_price }}</div>
															<div class="h6 fw-light fw-bold text-success ms-3" style="font-size: 15px;">{{ product.offer.percent }}% off</div>
															{% else %}
															<div class="h6 fw-bold" style="font-size: 17px;">{{ product.display_price }}</div>
															{% endif %}
														</div>
													</div>
												</div>
											</div>
											{% endfor %}
										</div><!--end row-->
									</div>
									
									<hr>
									<div class="d-flex justify-content-center mt-4">
										<ul class="pagination">
											{% if paginated_objects.has_previous %}
												<li class="page-item"><a class="page-link" href="?page=1">&laquo; First</a></li>
												<li class="page-item"><a class="page-link" href="?page={{ paginated_objects.previous_page_number }}">Previous</a></li>
											{% endif %}
									
											{% for num in paginated_objects.paginator.page_range %}
												{% if num == paginated_objects.number %}
													<li class="page-item active" aria-current="page"><span class="page-link">{{ num }}<span class="visually-hidden">(current)</span></span></li>
												{% else %}
													<li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
												{% endif %}
											{% endfor %}
									
											{% if paginated_objects.has_next %}
												<li class="page-item"><a class="page-link" href="?page={{ paginated_objects.next_page_number }}">Next</a></li>
												<li class="page-item"><a class="page-link" href="?page={{ paginated_objects.paginator.num_pages }}">Last &raquo;</a></li>
											{% endif %}
										</ul>
									</div>
								</div>
							</div>
						</div>
						<!--end row-->
					</div>
				</section>
				<!--end shop area-->
			</div>
		</div>
		<!--end page wrapper -->

{% endblock %}

{% block script %}

<!-- ----Filter-Products-AJAX---- -->
<script>
    $(document).ready(function(){
        $(".filter-checkbox").on("click", function(){
            console.log("A checkbox has been clicked");

            let filter_object = {}

            $(".filter-checkbox:checked").each(function(){
                let filter_value = $(this).val()
                let filter_key = $(this).data("filter")

                if (!filter_object[filter_key]) {
                    filter_object[filter_key] = [];
                }

                filter_object[filter_key].push(filter_value);
            })

			let minPrice = $("#minPrice").val();
            let maxPrice = $("#maxPrice").val();

            filter_object['min_price'] = minPrice;
            filter_object['max_price'] = maxPrice;

            console.log("Filter Objects: ", filter_object)
			$.ajax({
				url: '/filter-product',
				data: filter_object,
				dataType: 'json',
				beforeSend: function(){
					console.log("Trying to filter product...");
				},
				success: function(response){
					console.log(response);
					console.log("Data filtered successfully");
					$("#filtered-product").html(response.data)
				}
			})
        })
    })
</script>


{% endblock %}